<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minhas Transfer√™ncias | Cambio Bank</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
    /* ============================================
       VARI√ÅVEIS CSS (EXATAMENTE IGUAL AO DASHBOARD)
    ============================================ */
    :root {
        /* PALETA DE CORES DO SEU KIVY/DASHBOARD */
        --cor-fundo: #0a0e15;
        --cor-card: #0d1117;
        --cor-borda: #1e232e;
        --cor-texto: #e0e0e0;
        --cor-texto-secundario: #8b949e;
        --cor-primaria: #1a5fb4;
        --cor-sucesso: #2ec27e;
        --cor-alerta: #f39c12;
        --cor-perigo: #e01b24;
        --roxo: #9b59b6;
        
        /* SOMBRAS (IGUAL DASHBOARD) */
        --sombra-suave: 0 4px 6px rgba(0, 0, 0, 0.3);
        --sombra-media: 0 8px 16px rgba(0, 0, 0, 0.4);
        --sombra-forte: 0 12px 24px rgba(0, 0, 0, 0.5);
        
        /* BORDAS (IGUAL DASHBOARD) */
        --borda-radius: 12px;
        --borda-radius-pequeno: 8px;
    }

    /* ============================================
       RESET E CONFIGURA√á√ïES GERAIS
    ============================================ */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
        background: #070b12;  /* MAIS ESCURO QUE O DASHBOARD */
        color: var(--cor-texto);
        min-height: 100vh;
        margin: 0;
        padding: 0;
    }

    /* ============================================
       CONTAINER PRINCIPAL
    ============================================ */
    .app-container {
        background: var(--cor-fundo);  /* #0a0e15 */
        min-height: 100vh;
        max-width: 1400px;
        margin: 0 auto;
        width: 100%;
    }

    /* ============================================
       CABE√áALHO (EXATAMENTE IGUAL AO DASHBOARD)
    ============================================ */
    .app-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 30px;
        background: var(--cor-card);
        border-bottom: 1px solid var(--cor-borda);
        position: sticky;
        top: 0;
        z-index: 100;
    }

    .logo {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 24px;
        font-weight: bold;
    }

    .logo i {
        color: var(--cor-primaria);
        font-size: 28px;
    }

    .logo-text {
        background: linear-gradient(90deg, var(--cor-primaria), #2d8fff);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
    }

    .user-menu {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px 16px;
        background: var(--cor-card);
        border-radius: var(--borda-radius-pequeno);
        border: 1px solid var(--cor-borda);
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .user-menu:hover {
        border-color: var(--cor-primaria);
        transform: translateY(-2px);
    }

    .user-avatar {
        font-size: 24px;
        color: var(--cor-primaria);
    }

    .user-name {
        font-weight: 600;
    }

    .btn-voltar-dashboard {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 20px;
        background: transparent;
        border: 1px solid var(--cor-borda);
        color: var(--cor-texto);
        border-radius: var(--borda-radius-pequeno);
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .btn-voltar-dashboard:hover {
        border-color: var(--cor-primaria);
        background: rgba(26, 95, 180, 0.1);
        transform: translateY(-1px);
    }

    /* ============================================
       CONTE√öDO PRINCIPAL
    ============================================ */
    .main-content {
        padding: 30px;
    }

    /* ============================================
       T√çTULO DA P√ÅGINA (ESTILO DASHBOARD)
    ============================================ */
    .page-header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px 0;
    }

    .page-title {
        font-size: 28px;
        margin-bottom: 10px;
        color: var(--cor-texto);
        display: flex;
        align-items: center;
        gap: 12px;
        justify-content: center;
    }

    .page-title i {
        color: var(--cor-primaria);
    }

    .page-subtitle {
        color: var(--cor-texto-secundario);
        font-size: 16px;
        margin: 0;
    }

    /* ============================================
       FILTROS R√ÅPIDOS (ESTILO DASHBOARD)
    ============================================ */
    .filtros-container {
        margin-bottom: 30px;
    }

    .filtros-title {
        font-size: 14px;
        color: var(--cor-texto-secundario);
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .filtros-rapidos {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .btn-filtro {
        padding: 10px 20px;
        border: 1px solid var(--cor-borda);
        border-radius: var(--borda-radius-pequeno);
        background: transparent;
        color: var(--cor-texto);
        cursor: pointer;
        font-weight: 500;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .btn-filtro:hover {
        border-color: var(--cor-primaria);
        background: rgba(26, 95, 180, 0.1);
    }

    .btn-filtro.ativo {
        background: var(--cor-primaria);
        color: white;
        border-color: var(--cor-primaria);
    }

    #btn-pendentes.ativo {
        background: var(--cor-alerta);
        border-color: var(--cor-alerta);
    }

    #btn-processando.ativo {
        background: var(--cor-primaria);
        border-color: var(--cor-primaria);
    }

    #btn-concluidas.ativo {
        background: var(--cor-sucesso);
        border-color: var(--cor-sucesso);
    }

    #btn-recusadas.ativo {
        background: var(--cor-perigo);
        border-color: var(--cor-perigo);
    }

    /* ============================================
       CARDS DE TRANSFER√äNCIA (COM EFEITOS DASHBOARD)
    ============================================ */
    .transferencias-container {
        margin-bottom: 40px;
    }

    .card-transferencia {
        background: var(--cor-card);
        border: 1px solid var(--cor-borda);
        border-radius: var(--borda-radius);
        padding: 25px;
        position: relative;
        overflow: hidden;
        margin-bottom: 20px;
        transition: all 0.3s ease;
        box-shadow: var(--sombra-suave);
    }

    /* LINHA SUPERIOR COLORIDA (status) */
    .card-transferencia::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--cor-primaria), transparent);
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    /* CORES POR STATUS NA LINHA SUPERIOR */
    .card-transferencia[data-status="pending"]::before,
    .card-transferencia[data-status="pendente"]::before {
        background: linear-gradient(90deg, var(--cor-alerta), transparent);
    }

    .card-transferencia[data-status="processing"]::before,
    .card-transferencia[data-status="processando"]::before {
        background: linear-gradient(90deg, var(--cor-primaria), transparent);
    }

    .card-transferencia[data-status="completed"]::before,
    .card-transferencia[data-status="concluida"]::before {
        background: linear-gradient(90deg, var(--cor-sucesso), transparent);
    }

    .card-transferencia[data-status="rejected"]::before,
    .card-transferencia[data-status="recusada"]::before {
        background: linear-gradient(90deg, var(--cor-perigo), transparent);
    }

    /* EFEITO HOVER IGUAL AOS CARDS DO DASHBOARD */
    .card-transferencia:hover {
        border-color: var(--cor-primaria);
        transform: translateY(-5px);
        box-shadow: var(--sombra-forte);
    }

    .card-transferencia:hover::before {
        opacity: 1;
    }

    /* BORDA COM GRADIENTE NO HOVER */
    .card-transferencia::after {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        border-radius: calc(var(--borda-radius) + 2px);
        background: linear-gradient(45deg, 
            transparent 0%,
            var(--cor-primaria) 50%,
            transparent 100%
        );
        z-index: -1;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .card-transferencia:hover::after {
        opacity: 0.3;
    }

    /* GRADIENTE ESPEC√çFICO POR STATUS NO HOVER */
    .card-transferencia[data-status="pending"]:hover::after,
    .card-transferencia[data-status="pendente"]:hover::after {
        background: linear-gradient(45deg, 
            transparent 0%,
            var(--cor-alerta) 50%,
            transparent 100%
        );
    }

    .card-transferencia[data-status="processing"]:hover::after,
    .card-transferencia[data-status="processando"]:hover::after {
        background: linear-gradient(45deg, 
            transparent 0%,
            var(--cor-primaria) 50%,
            transparent 100%
        );
    }

    .card-transferencia[data-status="completed"]:hover::after,
    .card-transferencia[data-status="concluida"]:hover::after {
        background: linear-gradient(45deg, 
            transparent 0%,
            var(--cor-sucesso) 50%,
            transparent 100%
        );
    }

    .card-transferencia[data-status="rejected"]:hover::after,
    .card-transferencia[data-status="recusada"]:hover::after {
        background: linear-gradient(45deg, 
            transparent 0%,
            var(--cor-perigo) 50%,
            transparent 100%
        );
    }

    /* ============================================
       HEADER DO CARD
    ============================================ */
    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--cor-borda);
        position: relative;
    }

    /* BADGE DE STATUS (IGUAL DASHBOARD) */
    .status-badge {
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
    }

    .card-transferencia:hover .status-badge {
        transform: scale(1.05);
    }

    /* CORES DOS STATUS */
    .status-pending {
        background: rgba(243, 156, 18, 0.15);
        color: var(--cor-alerta);
        border: 1px solid rgba(243, 156, 18, 0.3);
    }

    .status-processing {
        background: rgba(26, 95, 180, 0.15);
        color: var(--cor-primaria);
        border: 1px solid rgba(26, 95, 180, 0.3);
    }

    .status-completed {
        background: rgba(46, 194, 126, 0.15);
        color: var(--cor-sucesso);
        border: 1px solid rgba(46, 194, 126, 0.3);
    }

    .status-rejected {
        background: rgba(224, 27, 36, 0.15);
        color: var(--cor-perigo);
        border: 1px solid rgba(224, 27, 36, 0.3);
    }

    .transferencia-id {
        font-size: 12px;
        color: var(--cor-texto-secundario);
        font-family: monospace;
        background: rgba(255, 255, 255, 0.05);
        padding: 4px 8px;
        border-radius: 4px;
    }

    /* ============================================
       CONTE√öDO DO CARD
    ============================================ */
    .card-content {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }

    .info-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .info-label {
        font-size: 11px;
        color: var(--cor-texto-secundario);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .info-value {
        font-size: 14px;
        font-weight: 500;
        color: var(--cor-texto);
    }

    .valor-destaque {
        font-size: 20px;
        font-weight: bold;
        color: var(--cor-texto);
    }

    /* ============================================
       LINHA DA INVOICE
    ============================================ */
    .invoice-line {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 15px;
        padding: 12px 15px;
        background: rgba(255, 255, 255, 0.03);
        border-radius: var(--borda-radius-pequeno);
        border: 1px solid var(--cor-borda);
    }

    .invoice-status {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        font-weight: 500;
    }

    .invoice-status.pending { 
        color: var(--cor-alerta);
    }
    
    .invoice-status.approved { 
        color: var(--cor-sucesso);
    }
    
    .invoice-status.rejected { 
        color: var(--cor-perigo);
    }

    .btn-renviar-invoice {
        padding: 6px 12px;
        background: transparent;
        border: 1px solid var(--cor-sucesso);
        color: var(--cor-sucesso);
        border-radius: var(--borda-radius-pequeno);
        font-size: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: all 0.3s;
    }

    .btn-renviar-invoice:hover {
        background: rgba(46, 194, 126, 0.1);
        transform: translateY(-1px);
    }

    /* ============================================
       FOOTER DO CARD
    ============================================ */
    .card-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 20px;
        padding-top: 15px;
        border-top: 1px solid var(--cor-borda);
    }

    .data-transferencia {
        font-size: 12px;
        color: var(--cor-texto-secundario);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* ============================================
       BOT√ïES DE A√á√ÉO
    ============================================ */
    .botoes-acao {
        display: flex;
        gap: 10px;
    }

    .btn-acao {
        padding: 8px 16px;
        border: 1px solid var(--cor-borda);
        border-radius: var(--borda-radius-pequeno);
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        transition: all 0.3s;
        background: transparent;
        color: var(--cor-texto);
    }

    .btn-detalhes:hover {
        border-color: var(--cor-primaria);
        color: var(--cor-primaria);
        background: rgba(26, 95, 180, 0.1);
    }

    .btn-invoice:hover {
        border-color: var(--cor-sucesso);
        color: var(--cor-sucesso);
        background: rgba(46, 194, 126, 0.1);
    }

    .btn-pdf:hover {
        border-color: var(--roxo);
        color: var(--roxo);
        background: rgba(155, 89, 182, 0.1);
    }

    /* ============================================
       BOT√ÉO CARREGAR MAIS
    ============================================ */
    .btn-carregar-mais {
        background: linear-gradient(135deg, var(--cor-primaria), #2d8fff);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: var(--borda-radius);
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(26, 95, 180, 0.3);
        display: inline-flex;
        align-items: center;
        gap: 10px;
        justify-content: center;
        margin: 30px auto;
        display: block;
    }

    .btn-carregar-mais:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(26, 95, 180, 0.4);
    }

    .btn-carregar-mais i {
        font-size: 18px;
    }

    .btn-carregar-mais small {
        font-size: 12px;
        opacity: 0.8;
        font-weight: normal;
        display: block;
        margin-top: 4px;
    }

    /* ============================================
       MENSAGEM VAZIA
    ============================================ */
    .mensagem-vazia {
        text-align: center;
        padding: 60px 20px;
        color: var(--cor-texto-secundario);
        background: var(--cor-card);
        border: 1px solid var(--cor-borda);
        border-radius: var(--borda-radius);
    }

    .mensagem-vazia i {
        font-size: 48px;
        margin-bottom: 20px;
        opacity: 0.5;
    }

    /* ============================================
       LOADING
    ============================================ */
    .loading {
        text-align: center;
        padding: 40px;
        color: var(--cor-texto-secundario);
    }

    .loading i {
        font-size: 24px;
        margin-bottom: 10px;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* ============================================
       FOOTER (IGUAL AO DASHBOARD)
    ============================================ */
    .app-footer {
        margin-top: 40px;
        padding-top: 20px;
        border-top: 1px solid var(--cor-borda);
    }

    .footer-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: var(--cor-texto-secundario);
        font-size: 14px;
    }

    .footer-links {
        display: flex;
        gap: 20px;
    }

    .footer-links a {
        color: var(--cor-texto-secundario);
        text-decoration: none;
        transition: color 0.3s ease;
    }

    .footer-links a:hover {
        color: var(--cor-primaria);
    }

    .status-online {
        color: var(--cor-sucesso);
        font-weight: 600;
    }

    /* ============================================
       RESPONSIVIDADE
    ============================================ */
    @media (max-width: 768px) {
        .app-container {
            padding: 10px;
        }
        
        .app-header {
            flex-direction: column;
            gap: 15px;
            text-align: center;
        }
        
        .filtros-rapidos {
            justify-content: center;
        }
        
        .card-content {
            grid-template-columns: 1fr;
        }
        
        .card-footer {
            flex-direction: column;
            gap: 15px;
        }
        
        .botoes-acao {
            width: 100%;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .footer-content {
            flex-direction: column;
            gap: 10px;
            text-align: center;
        }
        
        .footer-links {
            justify-content: center;
        }
    }

    /* ============================================
       UTILITIES
    ============================================ */
    .hidden {
        display: none !important;
    }

    .text-center {
        text-align: center;
    }

    /* ============================================
    BOT√ÉO ATUALIZAR NO HEADER
    ============================================ */
    .btn-atualizar {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 20px;
        background: transparent;
        border: 1px solid var(--cor-borda);
        color: var(--cor-texto);
        border-radius: var(--borda-radius-pequeno);
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-atualizar:hover {
        border-color: var(--cor-sucesso);
        color: var(--cor-sucesso);
        background: rgba(46, 194, 126, 0.1);
        transform: translateY(-1px);
    }

    .btn-atualizar.animando i {
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    </style>
</head>
<body>
<div class="app-container">
    
    <!-- CABE√áALHO -->
    <header class="app-header">
        <div class="logo">
            <i class="fas fa-university"></i>
            <span class="logo-text">Cambio Bank</span>
        </div>
        
        <div style="display: flex; align-items: center; gap: 20px;">
            <a href="/dashboard" class="btn-voltar-dashboard">
                <i class="fas fa-arrow-left"></i>
                Voltar ao Dashboard
            </a>
            
            <div class="user-menu">
                <div class="user-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="user-name" id="userName">Carregando...</div>
            </div>
        </div>
    </header>
    
    <!-- CONTE√öDO PRINCIPAL -->
    <main class="main-content">
        <!-- T√çTULO -->
        <div class="page-header">
            <h1 class="page-title">
                <i class="fas fa-exchange-alt"></i>
                MINHAS TRANSFER√äNCIAS
            </h1>
            <p class="page-subtitle">Gerencie e acompanhe todas as suas transfer√™ncias internacionais</p>
        </div>
        
        <!-- FILTROS -->
        <div class="filtros-container">
            <div class="filtros-title">
                <i class="fas fa-filter"></i> Filtrar por Status:
            </div>
            <div class="filtros-rapidos">
                <button class="btn-filtro ativo" id="btn-todas" onclick="filtrarTransferencias('all')">
                    <i class="fas fa-layer-group"></i> Todas
                </button>
                <button class="btn-filtro" id="btn-pendentes" onclick="filtrarTransferencias('pending')">
                    <i class="fas fa-clock"></i> Pendentes
                </button>
                <button class="btn-filtro" id="btn-processando" onclick="filtrarTransferencias('processing')">
                    <i class="fas fa-sync-alt"></i> Processando
                </button>
                <button class="btn-filtro" id="btn-concluidas" onclick="filtrarTransferencias('completed')">
                    <i class="fas fa-check-circle"></i> Conclu√≠das
                </button>
                <button class="btn-filtro" id="btn-recusadas" onclick="filtrarTransferencias('rejected')">
                    <i class="fas fa-times-circle"></i> Recusadas
                </button>
            </div>
        </div>
        
        <!-- LISTA DE TRANSFER√äNCIAS -->
        <div class="transferencias-container">
            <div id="listaTransferencias">
                <!-- Loading inicial -->
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Carregando transfer√™ncias...</p>
                </div>
            </div>
            
            <!-- Mensagem vazia -->
            <div id="mensagemVazia" class="mensagem-vazia hidden">
                <i class="fas fa-inbox"></i>
                <h3>Nenhuma transfer√™ncia encontrada</h3>
                <p>Voc√™ ainda n√£o realizou transfer√™ncias internacionais.</p>
                <a href="/transferencia" class="btn-voltar-dashboard" style="margin-top: 20px;">
                    <i class="fas fa-plus"></i> Nova Transfer√™ncia
                </a>
            </div>
            
            <!-- Bot√£o Carregar Mais -->
            <div id="carregarMaisContainer" class="hidden"></div>
        </div>
    </main>
    
    <!-- FOOTER -->
    <footer class="app-footer">
        <div class="footer-content">
            <div class="footer-copyright">
                ¬© 2024 Cambio Bank ‚Ä¢ Sistema de C√¢mbio Internacional
            </div>
            <div class="footer-links">
                <a href="#"><i class="fas fa-shield-alt"></i> Seguran√ßa</a>
                <a href="#"><i class="fas fa-question-circle"></i> Ajuda</a>
                <a href="#"><i class="fas fa-envelope"></i> Contato</a>
            </div>
            <div class="footer-version">
                v2.1.0 ‚Ä¢ <span class="status-online">‚óè Online</span>
            </div>
        </div>
    </footer>
</div>

<!-- JAVASCRIPT -->
<script>
    // DADOS GLOBAIS
    let todasTransferencias = [];
    let transferenciasFiltradas = [];
    let filtroAtual = 'all';
    
    // VARI√ÅVEIS DE PAGINA√á√ÉO
    let limiteAtual = 10;
    const limitePorPagina = 10;
    
    // INICIAR CARREGAMENTO
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ P√°gina Minhas Transfer√™ncias carregada');
        carregarUsuario();
        carregarTransferencias();
    });
    
    // CARREGAR USU√ÅRIO
    async function carregarUsuario() {
        try {
            const userNameElement = document.getElementById('userName');
            if (userNameElement) {
                userNameElement.textContent = window.USER?.nome || 'Usu√°rio';
            }
        } catch (error) {
            console.log('Erro ao carregar usu√°rio:', error);
        }
    }
    
    // CARREGAR TRANSFER√äNCIAS
    async function carregarTransferencias() {
        try {
            // Limpar loading
            document.getElementById('listaTransferencias').innerHTML = '';
            
            const response = await fetch('/api/transferencias-internacionais');
            if (response.ok) {
                const data = await response.json();
                console.log(`‚úÖ ${data.length} transfer√™ncias carregadas`);
                
                todasTransferencias = data;
                filtrarTransferencias('all');
                
                // Configurar auto-atualiza√ß√£o (1 minuto)
                //setInterval(() => {
                //    if (document.visibilityState === 'visible') {
                //        carregarTransferencias();
                //    }
                //}, 60000);
                
            } else {
                console.error('‚ùå Erro ao carregar transfer√™ncias:', response.status);
                mostrarErro('Erro ao carregar transfer√™ncias');
            }
        } catch (error) {
            console.error('‚ùå Erro de rede:', error);
            mostrarErro('Erro de conex√£o');
        }
    }
    
    // ADICIONE esta fun√ß√£o para o bot√£o atualizar:
    function setupAtualizacaoManual() {
        const btnAtualizar = document.getElementById('btnAtualizar');
        let estaAtualizando = false;
        
        if (btnAtualizar) {
            btnAtualizar.addEventListener('click', async function() {
                if (estaAtualizando) return;
                
                // Mostrar anima√ß√£o
                estaAtualizando = true;
                btnAtualizar.classList.add('animando');
                btnAtualizar.disabled = true;
                
                try {
                    await carregarTransferencias();
                    
                    // Mostrar feedback visual
                    btnAtualizar.innerHTML = '<i class="fas fa-check"></i> Atualizado!';
                    btnAtualizar.style.borderColor = 'var(--cor-sucesso)';
                    btnAtualizar.style.color = 'var(--cor-sucesso)';
                    
                    setTimeout(() => {
                        btnAtualizar.innerHTML = '<i class="fas fa-sync-alt"></i> Atualizar';
                        btnAtualizar.style.borderColor = '';
                        btnAtualizar.style.color = '';
                        btnAtualizar.classList.remove('animando');
                        btnAtualizar.disabled = false;
                        estaAtualizando = false;
                    }, 1500);
                    
                } catch (error) {
                    console.error('Erro ao atualizar:', error);
                    
                    // Mostrar erro
                    btnAtualizar.innerHTML = '<i class="fas fa-times"></i> Erro';
                    btnAtualizar.style.borderColor = 'var(--cor-perigo)';
                    btnAtualizar.style.color = 'var(--cor-perigo)';
                    
                    setTimeout(() => {
                        btnAtualizar.innerHTML = '<i class="fas fa-sync-alt"></i> Atualizar';
                        btnAtualizar.style.borderColor = '';
                        btnAtualizar.style.color = '';
                        btnAtualizar.classList.remove('animando');
                        btnAtualizar.disabled = false;
                        estaAtualizando = false;
                    }, 2000);
                }
            });
        }
    }

    // NO DOMContentLoaded, adicione:
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ P√°gina Minhas Transfer√™ncias carregada');
        carregarUsuario();
        carregarTransferencias();
        setupAtualizacaoManual();  // <-- ADICIONE ESTA LINHA
    });

    // FILTRAR TRANSFER√äNCIAS
    function filtrarTransferencias(filtro) {
        filtroAtual = filtro;
        
        // Atualizar bot√µes ativos
        document.querySelectorAll('.btn-filtro').forEach(btn => {
            btn.classList.remove('ativo');
        });
        
        document.getElementById(`btn-${getNomeFiltro(filtro)}`).classList.add('ativo');
        
        // Aplicar filtro
        if (filtro === 'all') {
            transferenciasFiltradas = [...todasTransferencias];
        } else {
            transferenciasFiltradas = todasTransferencias.filter(t => {
                if (filtro === 'pending') {
                    return t.status === 'pending' || t.status === 'pendente' || t.status === 'solicitada';
                }
                if (filtro === 'processing') {
                    return t.status === 'processing' || t.status === 'processando';
                }
                if (filtro === 'completed') {
                    return t.status === 'completed' || t.status === 'concluida' || t.status === 'aprovada';
                }
                if (filtro === 'rejected') {
                    return t.status === 'rejected' || t.status === 'recusada';
                }
                return t.status === filtro;
            });
        }
        
        // Ordenar por data (mais recente primeiro)
        transferenciasFiltradas.sort((a, b) => {
            return new Date(b.data || b.created_at) - new Date(a.data || a.created_at);
        });
        
        // Resetar limite ao filtrar
        limiteAtual = 10;
        
        // Atualizar lista
        atualizarListaTransferencias();
    }
    
    // ATUALIZAR LISTA
    function atualizarListaTransferencias() {
        const lista = document.getElementById('listaTransferencias');
        const mensagemVazia = document.getElementById('mensagemVazia');
        
        if (transferenciasFiltradas.length === 0) {
            lista.innerHTML = '';
            mensagemVazia.classList.remove('hidden');
            return;
        }
        
        mensagemVazia.classList.add('hidden');
        
        // PEGAR APENAS AS PRIMEIRAS X TRANSFER√äNCIAS
        const transferenciasParaExibir = transferenciasFiltradas.slice(0, limiteAtual);
        
        let html = '';
        
        transferenciasParaExibir.forEach(transferencia => {
            const status = transferencia.status;
            const statusClass = getStatusClass(status);
            const statusText = getStatusText(status);
            const valorFormatado = formatarMoeda(transferencia.valor, transferencia.moeda);
            const dataFormatada = formatarData(transferencia.data || transferencia.created_at);
            
            // Verificar status da invoice
            const invoiceStatus = transferencia.invoice_status || 'pending';
            const invoiceRecusada = transferencia.invoice_recusada || false;
            const temInvoice = transferencia.invoice || transferencia.invoice_status;
            
            // STATUS PARA O DATA-ATTRIBUTE (corre√ß√£o aqui)
            const dataStatus = getDataStatus(status);
            
            // Gerar HTML do card
            html += `
            <div class="card-transferencia" data-id="${transferencia.id}" data-status="${dataStatus}">
                <div class="card-header">
                    <div class="status-badge ${statusClass}">
                        <i class="fas ${getStatusIcon(status)}"></i>
                        ${statusText}
                    </div>
                    <div class="transferencia-id">#${transferencia.id}</div>
                </div>
                
                <div class="card-content">
                    <div class="info-group">
                        <div class="info-label">Benefici√°rio</div>
                        <div class="info-value">${transferencia.beneficiario || 'N/A'}</div>
                    </div>
                    
                    <div class="info-group">
                        <div class="info-label">Banco</div>
                        <div class="info-value">${transferencia.nome_banco || 'N/A'}</div>
                    </div>
                    
                    <div class="info-group">
                        <div class="info-label">Pa√≠s</div>
                        <div class="info-value">${transferencia.pais || 'N/A'}</div>
                    </div>
                    
                    <div class="info-group">
                        <div class="info-label">Valor</div>
                        <div class="info-value valor-destaque">${valorFormatado}</div>
                    </div>
                </div>
                
                ${temInvoice ? criarLinhaInvoice(invoiceStatus, invoiceRecusada, transferencia.id) : ''}
                
                <div class="card-footer">
                    <div class="data-transferencia">
                        <i class="far fa-calendar"></i>
                        ${dataFormatada}
                    </div>
                    
                    <div class="botoes-acao">
                        <button class="btn-acao btn-detalhes" onclick="mostrarDetalhes('${transferencia.id}')">
                            <i class="fas fa-eye"></i> Detalhes
                        </button>
                        
                        ${temInvoice ? `
                        <button class="btn-acao btn-invoice" onclick="visualizarInvoice('${transferencia.id}')">
                            <i class="fas fa-file-invoice"></i> Invoice
                        </button>
                        ` : ''}
                        
                        <button class="btn-acao btn-pdf" onclick="gerarPDF('${transferencia.id}')">
                            <i class="fas fa-file-pdf"></i> PDF
                        </button>
                    </div>
                </div>
            </div>
            `;
        });
        
        // ADICIONAR BOT√ÉO "CARREGAR MAIS" SE HOUVER MAIS TRANSFER√äNCIAS
        if (transferenciasFiltradas.length > limiteAtual) {
            const restantes = transferenciasFiltradas.length - limiteAtual;
            const proximaLimite = Math.min(restantes, limitePorPagina);
            
            html += `
            <div style="text-align: center; margin-top: 30px;">
                <button onclick="carregarMais()" class="btn-carregar-mais">
                    <i class="fas fa-plus-circle"></i> Carregar mais ${proximaLimite} transfer√™ncias
                    <br><small>(${restantes} restantes no total)</small>
                </button>
            </div>
            `;
        }
        
        lista.innerHTML = html;
    }
    
    // FUN√á√ÉO CARREGAR MAIS
    function carregarMais() {
        limiteAtual += limitePorPagina;
        atualizarListaTransferencias();
    }
    
    // FUN√á√ïES AUXILIARES
    function getStatusClass(status) {
        switch (status) {
            case 'pending':
            case 'pendente':
            case 'solicitada':
                return 'status-pending';
            case 'processing':
            case 'processando':
                return 'status-processing';
            case 'completed':
            case 'concluida':
            case 'aprovada':
                return 'status-completed';
            case 'rejected':
            case 'recusada':
                return 'status-rejected';
            default:
                return 'status-pending';
        }
    }
    
    function getDataStatus(status) {
        switch (status) {
            case 'pending':
            case 'pendente':
            case 'solicitada':
                return 'pending';
            case 'processing':
            case 'processando':
                return 'processing';
            case 'completed':
            case 'concluida':
            case 'aprovada':
                return 'completed';
            case 'rejected':
            case 'recusada':
                return 'rejected';
            default:
                return 'pending';
        }
    }
    
    function getStatusText(status) {
        switch (status) {
            case 'pending':
            case 'pendente':
            case 'solicitada':
                return 'Pendente';
            case 'processing':
            case 'processando':
                return 'Processando';
            case 'completed':
            case 'concluida':
            case 'aprovada':
                return 'Conclu√≠da';
            case 'rejected':
            case 'recusada':
                return 'Recusada';
            default:
                return status;
        }
    }
    
    function getStatusIcon(status) {
        switch (status) {
            case 'pending':
            case 'pendente':
            case 'solicitada':
                return 'fa-clock';
            case 'processing':
            case 'processando':
                return 'fa-sync-alt';
            case 'completed':
            case 'concluida':
            case 'aprovada':
                return 'fa-check-circle';
            case 'rejected':
            case 'recusada':
                return 'fa-times-circle';
            default:
                return 'fa-clock';
        }
    }
    
    function getNomeFiltro(filtro) {
        switch (filtro) {
            case 'all': return 'todas';
            case 'pending': return 'pendentes';
            case 'processing': return 'processando';
            case 'completed': return 'concluidas';
            case 'rejected': return 'recusadas';
            default: return 'todas';
        }
    }
    
    // FUN√á√ÉO CRIAR LINHA INVOICE (CORRIGIDA)
    function criarLinhaInvoice(status, recusada, transferenciaId) {
        let statusClass = 'pending';
        let statusIcon = 'fa-clock';
        let statusText = 'Pendente';
        let showButton = false;
        
        if (status === 'approved') {
            statusClass = 'approved';
            statusIcon = 'fa-check-circle';
            statusText = 'Aprovada';
        } else if (status === 'rejected' || recusada) {
            statusClass = 'rejected';
            statusIcon = 'fa-times-circle';
            statusText = 'Recusada';
            showButton = true;
        }
        
        return `
        <div class="invoice-line">
            <div class="invoice-status ${statusClass}">
                <i class="fas ${statusIcon}"></i>
                <strong>Invoice:</strong> ${statusText}
            </div>
            ${showButton ? `
            <button class="btn-renviar-invoice" onclick="reenviarInvoice('${transferenciaId}')">
                <i class="fas fa-redo"></i> Reenviar
            </button>
            ` : ''}
        </div>
        `;
    }
    
    function formatarMoeda(valor, moeda) {
        if (!valor) return '--';
        const simbolos = {
            'USD': '$', 'EUR': '‚Ç¨', 'GBP': '¬£', 'BRL': 'R$'
        };
        const simbolo = simbolos[moeda] || moeda;
        return `${simbolo} ${parseFloat(valor).toFixed(2)}`;
    }
    
    function formatarData(dataString) {
        if (!dataString) return '--';
        const data = new Date(dataString);
        return data.toLocaleDateString('pt-BR') + ' ' + data.toLocaleTimeString('pt-BR');
    }
    
    function mostrarErro(mensagem) {
        const lista = document.getElementById('listaTransferencias');
        lista.innerHTML = `
            <div class="mensagem-vazia">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>${mensagem}</h3>
                <button onclick="carregarTransferencias()" class="btn-voltar-dashboard" style="margin-top: 20px;">
                    <i class="fas fa-redo"></i> Tentar Novamente
                </button>
            </div>
        `;
    }
    
    // FUN√á√ïES DE A√á√ÉO (placeholder)
    function mostrarDetalhes(id) {
        alert('Detalhes da transfer√™ncia ' + id);
    }
    
    function visualizarInvoice(id) {
        alert('Visualizar invoice ' + id);
    }
    
    function gerarPDF(id) {
        alert('Gerar PDF da transfer√™ncia ' + id);
    }
    
    function reenviarInvoice(id) {
        alert('Reenviar invoice ' + id);
    }
</script>

<!-- DADOS DO FLASK -->
<script>
    // Dados do usu√°rio logado (do Flask)
    window.USER = { 
        username: "{{ usuario if usuario else '' }}", 
        nome: "{{ nome if nome else 'Usu√°rio' }}", 
        email: "{{ email if email else 'usuario@exemplo.com' }}"
    };
    window.API_URL = "";
</script>
</body>
</html>